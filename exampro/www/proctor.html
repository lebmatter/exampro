{% extends "exampro/templates/exam_base.html" %} {% block title %} Proctor {%
endblock %} {% block head_include %} {{ super() }} {% for ext in page_extensions
%} {{ ext.render_header() }} {% endfor %}
<link rel="stylesheet" href="/assets/exampro/css/proctor.css" />
{% endblock %} {% block page_content %} {% if alert %}
<div class="container mt-4 mb-4">
  <div class="alert-card">
    <div class="alert-card-header">
      <h4 class="mb-0">
        <i class="bi bi-clock"></i> Upcoming Proctoring Sessions
      </h4>
    </div>
    <div class="alert-card-body">
      <div class="alert-icon-section">
        <i class="bi bi-eye"></i>
      </div>
      <div class="alert-status">{{ alert.title }}</div>
      <div class="alert-message-box">
        <p>{{ alert.text }}</p>
      </div>
      <div class="alert-actions">
        <a href="/my-exams" class="alert-button alert-button-primary">
          <i class="bi bi-arrow-left"></i>My Exams
        </a>
      </div>
    </div>
  </div>
</div>
{% else %} {% if submissions|length > 0 or pending_candidates|length > 0 %}
<div class="container-fluid" style="width: 80%">
  {% else %}
  <div class="container">
    {% endif %}
    <div class="row mb-5">
      <div class="col">
        <h4>ðŸ‘€ Proctor Dashboard</h4>
      </div>
    </div>
    <div class="row">
      {% if submissions|length > 0 or pending_candidates|length > 0 %}
      <!-- Message Sidebar -->
      <div class="col-md-3">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">Latest Messages</h5>
          </div>
          <div class="card-body messages-sidebar">
            {% for msg in latest_messages %}
            <div
              class="card mb-2 message-card"
              data-submission="{{ msg.exam_submission }}"
            >
              <div class="card-body p-2">
                <div
                  class="d-flex justify-content-between align-items-center mb-1"
                >
                  <h6 class="card-subtitle text-muted mb-0">
                    {{ msg.candidate_name }}
                  </h6>
                  <span
                    class="badge status-badge status-{{ msg.status.lower() }}"
                    data-submission-status="{{ msg.status }}"
                    >{{ msg.status }}</span
                  >
                </div>
                <p class="card-text message-text mb-0">{{ msg.message }}</p>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Main Video Grid -->
      <div class="col-md-9">
        <!-- Main content -->
        <div class="row">
          <div class="col-md-6">
            <div class="d-flex justify-content-start">
              <button type="button" class="btn btn-primary mr-2">
                Live candidates
                <span class="badge badge-light">{{ submissions|length }}</span>
              </button>
              <button type="button" class="btn btn-secondary">
                Pending candidates
                <span class="badge badge-light"
                  >{{ pending_candidates|length }}</span
                >
              </button>
            </div>
          </div>
          <div class="col-md-6"></div>
        </div>

        <!-- Video Cards Grid - 4 per row -->
        <div class="row mt-4">
          {% for submission in submissions %}
          <div class="col-md-3 col-sm-6 mb-3">
            <div class="card video-card">
              <div
                class="card-header p-2 d-flex justify-content-between align-items-center"
              >
                <small class="text-truncate me-2"
                  >{{ submission.candidate_name }}</small
                >
              </div>
              <div class="card-body p-0">
                <div
                  class="video-container"
                  data-videoid="{{ submission.name }}"
                  data-candidatename="{{ submission.candidate_name }}"
                  data-islive="0"
                >
                  <video
                    class="video"
                    id="{{ submission.name }}"
                    data-videoid="{{ submission.name }}"
                    preload="metadata"
                  >
                    <p>Your browser doesn't support HTML5 video.</p>
                  </video>
                </div>
                <!-- Offline Overlay -->
                <div
                  class="offline-overlay"
                  id="offline-overlay-{{ submission.name }}"
                >
                  <div
                    class="offline-button"
                    onclick="toggleOfflineStatus('{{ submission.name }}')"
                  >
                    <i class="bi bi-wifi-off"></i>
                    <span>Offline</span>
                  </div>
                </div>
                <!-- Controls moved below video as centered button group -->
                <div class="video-controls">
                  <small
                    class="file-timestamp fileTimeStamp"
                    id="fileTimeStamp-{{ submission.name }}"
                  ></small>
                  <button
                    class="controls__button togglePlayBtn"
                    id="togglePlayBtn-{{ submission.name }}"
                    title="Toggle Play"
                    data-videoid="{{ submission.name }}"
                  >
                    <i class="bi bi-play-fill"></i>
                  </button>
                  <button
                    class="controls__button skipBack"
                    id="skipBack-{{ submission.name }}"
                    title="Skip back"
                    data-videoid="{{ submission.name }}"
                  >
                    <i class="bi bi-rewind-fill"></i>
                  </button>
                  <button
                    class="controls__button skipFwd"
                    id="skipFwd-{{ submission.name }}"
                    title="Skip forward"
                    data-videoid="{{ submission.name }}"
                  >
                    <i class="bi bi-fast-forward-fill"></i>
                  </button>
                  <button
                    class="controls__button goLive"
                    id="goLive-{{ submission.name }}"
                    title="Go Live"
                    data-videoid="{{ submission.name }}"
                  >
                    <i class="bi bi-broadcast-pin"></i>
                  </button>
                  <button
                    type="button"
                    class="controls__button chat-btn menu"
                    id="chat-btn-{{ submission.name }}"
                    title="Chat"
                    data-videoid="{{ submission.name }}"
                  >
                    <i class="bi bi-chat-square-text-fill"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% else %}
      <div class="col-12">
        <div
          class="d-flex justify-content-center align-items-center"
          style="min-height: 400px"
        >
          <div class="text-center" style="max-width: 600px">
            <img
              src="/assets/exampro/img/nothing-to-proc.png"
              alt="Nothing to proctor"
              class="img-fluid mb-4"
              style="max-width: 600px; opacity: 0.8"
            />
            <h4 class="text-muted mb-3">No Exams to Proctor</h4>
            <p class="text-muted mb-0" style="line-height: 1.6">
              There are currently no exam submissions assigned to you for
              proctoring. New submissions will appear here when they become
              available.
            </p>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <div
    class="modal fade"
    id="chatModal"
    tabindex="-1"
    aria-labelledby="chatVideoModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="chatVideoModalLabel">
            Chat with: <span id="candidateName"></span>
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          >
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <!-- Video Column (Left) -->
            <div class="col-md-5">
              <div class="modal-video-container">
                <video id="modalVideoElement" controls>
                  <source src="" type="video/mp4" />
                  Your browser does not support the video tag.
                </video>
                <div class="mt-3 text-center">
                  <button
                    type="button"
                    class="btn btn-danger"
                    id="terminateExam"
                  >
                    Terminate Exam
                  </button>
                </div>
              </div>
            </div>

            <!-- Chat Column (Right) -->
            <div class="col-md-7">
              <div id="messages" class="tab-pane fade show active">
                <div class="chat-container">
                  <div id="chat-messages" class="d-flex flex-column mb-3"></div>
                </div>
                <div class="chat-input-container">
                  <div class="input-group">
                    <input
                      type="text"
                      id="chat-input"
                      class="form-control"
                      placeholder="Type your message..."
                    />
                    <div class="input-group-append">
                      <button class="btn" type="button" id="proc-send-message">
                        <span class="d-flex align-items-center">
                          Send
                          <i class="bi bi-send ms-2"></i>
                        </span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %} {% endblock %}

  <!-- Scripts -->
  {%- block script %} {{ super() }}
  <script type="text/javascript" src="/assets/exampro/js/examutils.js"></script>
  <script
    type="text/javascript"
    src="/assets/exampro/js/proctorutils.js"
  ></script>

  {% endblock %}
</div>
